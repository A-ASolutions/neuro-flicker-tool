<!DOCTYPE html>
<html>
<head>
  <title>Neuro Flicker â€“ Dual Mode 40Hz (25ms)</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      color: white;
      font-family: sans-serif;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
  #controls {
     position: absolute;
     top: 20px;
     left: 20px;
     background: rgba(0, 0, 0, 0.7);
     padding: 20px;
     border-radius: 10px;
     z-index: 10;
     font-size: 16px;
     line-height: 1.6;
     max-width: 300px;
   }

    #timerDisplay {
      margin-top: 10px;
      font-weight: bold;
    }
    #branding {
      position: absolute;
      bottom: 10px;
      right: 10px;
      font-size: 12px;
      color: white;
      background: rgba(0, 0, 0, 0.5);
      padding: 6px 10px;
      border-radius: 6px;
      z-index: 10;
      pointer-events: none;
      user-select: none;
    }
  </style>
</head>
<body>
  <div id="controls">
    <label><input type="radio" name="mode" value="clinical" checked> Clinical Mode</label><br>
    <label><input type="radio" name="mode" value="safe"> Safe Mode</label><br>
    <label>Brightness (safe mode): <input type="range" id="brightness" min="0" max="255" value="136"></label><br>
    <label>Duration (minutes): <input type="number" id="duration" min="1" max="30" value="4"></label><br>
    <button onclick="startFlicker()">Start</button>
    <button onclick="stopFlicker()">Stop</button>
    <div id="timerDisplay">Remaining: 00:00</div>
  </div>

  <div id="branding">Designed by Meaningful Path Therapy (Abdullah Al-Shoaibi)</div>
  <canvas id="flickerCanvas"></canvas>

  <script>
    const canvas = document.getElementById("flickerCanvas");
    const ctx = canvas.getContext("2d");
    const brightnessSlider = document.getElementById("brightness");
    const durationInput = document.getElementById("duration");
    const timerDisplay = document.getElementById("timerDisplay");

    let animationId = null;
    let flickerIntervalId = null;
    let endTime = 0;
    let state = false;

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function getSelectedMode() {
      return document.querySelector('input[name="mode"]:checked').value;
    }

    function updateCanvas() {
      const mode = getSelectedMode();
      let color;

      if (mode === "clinical") {
        color = state ? "#FFFFFF" : "#000000";
      } else {
        const brightness = brightnessSlider.value;
        color = state ? `rgb(${brightness}, ${brightness}, ${brightness})` : "#000000";
      }

      ctx.fillStyle = color;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    function startFlicker() {
      const duration = parseInt(durationInput.value, 10);
      if (isNaN(duration) || duration < 1) return;

      endTime = Date.now() + duration * 60000;

      flickerIntervalId = setInterval(() => {
        state = !state;
        updateCanvas();
      }, 25); // 25ms toggle = 40Hz

      updateTimer();
    }

    function stopFlicker() {
      clearInterval(flickerIntervalId);
      cancelAnimationFrame(animationId);
      ctx.fillStyle = "black";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      timerDisplay.textContent = "Remaining: 00:00";
    }

    function updateTimer() {
      const remaining = Math.max(0, endTime - Date.now());
      const mins = String(Math.floor(remaining / 60000)).padStart(2, '0');
      const secs = String(Math.floor((remaining % 60000) / 1000)).padStart(2, '0');
      timerDisplay.textContent = `Remaining: ${mins}:${secs}`;

      if (remaining > 0) {
        animationId = requestAnimationFrame(updateTimer);
      } else {
        stopFlicker();
      }
    }
  </script>
</body>
</html>
